# 詳細統計資料取得實作說明

## 問題描述

班級數、學生數、教師數等詳細統計資料目前取得值為 None，可能需要點擊個別學校或使用其他方式取得。

## 實作方案

已實作以下方法來取得詳細統計資料：

### 1. 新增方法

#### `get_school_detail(school_link_element)`
- **功能**: 從學校詳細頁面取得詳細統計資料
- **參數**: `school_link_element` - Playwright Locator，指向學校連結
- **返回**: 包含詳細資料的字典（班級數、學生數、教師數、校地面積、校舍面積、棟數）

此方法會：
1. 點擊學校連結（支援新分頁或同一頁面開啟）
2. 等待詳細頁面載入
3. 從表格或文字中提取統計資料
4. 返回詳細資料並關閉詳細頁面

#### `parse_school_data_with_details(district)`
- **功能**: 解析搜尋結果並取得每個學校的詳細資料
- **參數**: `district` - 鄉鎮市區名稱（可選）
- **返回**: 包含詳細資料的學校資料列表

此方法會：
1. 從搜尋結果頁面找出所有學校連結
2. 逐一點擊每個學校連結
3. 從詳細頁面提取統計資料
4. 合併基本資訊和詳細資料

### 2. 修改的方法

#### `query_schools(county, district)`
- 現在會先嘗試使用新方法取得詳細資料
- 如果新方法失敗，則回退到原有的基本解析方法

## 使用方式

### 方法 1: 直接執行爬蟲
```python
from scraper import scrape_schools
import asyncio

schools = asyncio.run(scrape_schools())
```

### 方法 2: 使用測試腳本
```bash
python test_detailed_data.py
```

### 方法 3: 使用研究腳本（分析網站結構）
```bash
python research_site_structure.py
```

## 資料提取策略

系統會使用多種方法來提取詳細資料：

1. **從表格中提取**: 尋找包含「班級數」、「學生數」等標籤的表格行
2. **正則表達式匹配**: 從頁面文字中提取格式化的資料（例如：`班級數：12`）

## 注意事項

1. **處理時間**: 由於需要點擊每個學校連結，取得詳細資料會比較耗時
2. **錯誤處理**: 如果某個學校的詳細資料取得失敗，會跳過並繼續處理其他學校
3. **回退機制**: 如果新方法無法取得資料，會自動回退到原有的解析方法

## 測試結果

執行 `test_detailed_data.py` 可以查看：
- 總共有多少學校
- 有多少學校成功取得詳細資料
- 有哪些學校沒有詳細資料
- 詳細資料的範例

## 可能的改進方向

1. **並行處理**: 可以同時開啟多個詳細頁面來加快處理速度
2. **快取機制**: 快取已取得的詳細資料，避免重複請求
3. **更多資料來源**: 如果詳細頁面沒有資料，可以嘗試其他方式取得

## 問題排查

如果無法取得詳細資料，可以：

1. 執行 `research_site_structure.py` 來分析網站結構
2. 檢查網站是否改變了結構
3. 確認學校連結是否可點擊
4. 查看控制台輸出的錯誤訊息



