# 花蓮縣國小資料查詢系統

這是一個 Web 應用程式，從教育部統計處網站爬取花蓮縣所有鄉鎮市區各國小的統計資料，並提供網頁介面讓使用者查看和下載 CSV 檔案。

## 功能特色

- 📊 顯示花蓮縣所有13個鄉鎮市區各國小的統計資料
- 🗺️ 多選區域篩選功能，可選擇特定鄉鎮市區查看
- 💾 使用 SQLite 資料庫預先儲存資料，無需等待即時爬取
- ⏰ 自動定時更新：每六個月自動重新爬取資料
- 📥 提供 CSV 檔案下載功能（支援區域過濾）
- 🔄 手動刷新功能，可隨時觸發資料更新
- 📱 響應式設計，支援各種裝置

## 資料欄位

- 鄉鎮市區
- 學校名稱
- 班級數
- 學生數
- 教師數
- 校地面積（平方公尺）
- 校舍面積（平方公尺）

## 涵蓋區域

系統涵蓋花蓮縣所有13個鄉鎮市區：
- 花蓮市
- 吉安鄉
- 新城鄉
- 秀林鄉
- 壽豐鄉
- 鳳林鎮
- 光復鄉
- 豐濱鄉
- 瑞穗鄉
- 玉里鎮
- 富里鄉
- 卓溪鄉
- 萬榮鄉

## 本地開發設置

### 1. 安裝依賴

```bash
pip install -r requirements.txt
```

### 2. 安裝 Playwright 瀏覽器

```bash
playwright install chromium
```

### 3. 執行應用程式

```bash
python app.py
```

或使用 gunicorn：

```bash
gunicorn app:app
```

### 4. 訪問應用程式

開啟瀏覽器訪問：http://localhost:5000

### 5. 首次啟動

首次啟動時，系統會自動檢查資料庫：
- 如果資料庫為空，會立即執行首次爬取（可能需要較長時間）
- 如果資料已過期（超過六個月），會立即更新資料
- 爬取完成後，資料會儲存到 SQLite 資料庫（`schools.db`）

## Zeabur 部署步驟

### 方法一：透過 Git 部署

1. 將專案推送到 GitHub、GitLab 或 Bitbucket

2. 在 Zeabur 建立新專案

3. 連接您的 Git 儲存庫

4. Zeabur 會自動偵測 Python 專案並安裝依賴

5. 部署完成後，Zeabur 會提供一個網址

### 方法二：直接上傳

1. 在 Zeabur 建立新專案

2. 選擇「上傳程式碼」或「從檔案部署」

3. 上傳專案檔案

4. Zeabur 會自動偵測並部署

### 環境變數

目前不需要額外的環境變數設定。

### 部署注意事項

- 首次部署時，系統會自動執行爬取，可能需要較長時間
- 確保 Playwright 瀏覽器已正確安裝（Zeabur 會自動處理）
- 資料庫檔案會儲存在應用程式的工作目錄中

## 專案結構

```
hualian_elementary_building/
├── app.py               # Flask 應用程式主檔
├── scraper.py           # 爬蟲邏輯模組
├── database.py          # 資料庫操作模組
├── requirements.txt     # Python 套件依賴
├── Procfile             # Zeabur 部署配置
├── runtime.txt          # Python 版本指定
├── schools.db           # SQLite 資料庫（自動建立）
├── templates/
│   └── index.html       # 前端頁面
├── static/
│   └── style.css        # CSS 樣式
└── README.md            # 說明文件
```

## 技術棧

- **後端**: Flask (Python)
- **爬蟲**: Playwright + BeautifulSoup4
- **資料處理**: pandas
- **資料庫**: SQLite
- **定時任務**: APScheduler
- **部署**: Gunicorn + Zeabur

## 資料更新機制

### 自動更新

- 系統使用 APScheduler 設定定時任務
- 每六個月自動執行一次資料爬取
- 更新時間會在應用程式啟動時自動排程

### 手動更新

- 點擊網頁上的「重新載入資料」按鈕
- 系統會在背景執行爬取任務
- 完成後可重新載入頁面查看最新資料

### 資料儲存

- 所有資料儲存在 SQLite 資料庫中
- 資料庫檔案：`schools.db`
- 包含兩個主要表：
  - `schools`: 儲存學校資料
  - `scrape_log`: 記錄爬取歷史

## 使用方式

1. **查看所有資料**：開啟網頁後，預設顯示所有區域的資料

2. **篩選特定區域**：
   - 在「選擇區域」區塊中，取消勾選不需要的區域
   - 或使用「全選」/「取消全選」按鈕快速操作
   - 表格會即時更新顯示選取的區域資料

3. **下載 CSV**：
   - 點擊「下載 CSV」按鈕
   - 下載的檔案會包含目前篩選的區域資料
   - 檔案名稱格式：`花蓮縣國小資料_YYYYMMDD.csv`

4. **更新資料**：
   - 點擊「重新載入資料」按鈕觸發手動更新
   - 系統會在背景執行爬取，完成後提示重新載入頁面

## API 端點

### GET `/api/data`
取得學校資料（支援區域過濾）

**查詢參數**：
- `districts` (可選): 逗號分隔的鄉鎮市區列表，例如：`?districts=花蓮市,吉安鄉`

**回應**：
```json
{
  "success": true,
  "data": [...],
  "count": 100,
  "timestamp": "2024-01-01T00:00:00"
}
```

### GET `/api/districts`
取得所有可用的鄉鎮市區列表

**回應**：
```json
{
  "success": true,
  "districts": ["花蓮市", "吉安鄉", ...],
  "count": 13
}
```

### GET `/download/csv`
下載 CSV 檔案（支援區域過濾）

**查詢參數**：
- `districts` (可選): 逗號分隔的鄉鎮市區列表

### POST `/api/refresh`
手動觸發資料更新

## 注意事項

- 首次啟動時會執行爬取，可能需要較長時間（取決於網路速度和網站回應）
- 爬取過程會在背景執行，不會阻塞網頁服務
- 資料每六個月自動更新一次，確保資料時效性
- 請遵守網站的使用條款，避免過度頻繁的請求
- 資料庫檔案會持續累積，建議定期備份

## 授權

本專案僅供學習和研究使用。
